{"version":3,"file":"main.cjs","sources":["../../src/main.ts"],"sourcesContent":["import { app, BrowserWindow, shell, ipcMain, dialog, session } from 'electron';\r\nimport { readFile, writeFile } from 'fs/promises';\r\nimport { join, dirname } from 'path';\r\nimport { fileURLToPath } from 'url';\r\n\r\nconst __filename = fileURLToPath(import.meta.url);\r\nconst __dirname = dirname(__filename);\r\n\r\ndeclare const MAIN_WINDOW_VITE_DEV_SERVER_URL: string | undefined;\r\ndeclare const MAIN_WINDOW_VITE_NAME: string;\r\n\r\nlet mainWindow: BrowserWindow | null = null;\r\n\r\nasync function createMainWindow() {\r\n  mainWindow = new BrowserWindow({\r\n    width: 900,\r\n    height: 700,\r\n    frame: false, // Remove default frame for custom window controls\r\n    webPreferences: {\r\n      preload: join(__dirname, '../preload/index.js'),\r\n      contextIsolation: true,\r\n      nodeIntegration: false,\r\n      webSecurity: true // Enable web security\r\n    }\r\n  });\r\n\r\n  mainWindow.webContents.setWindowOpenHandler(({ url }) => {\r\n    shell.openExternal(url);\r\n    return { action: 'deny' };\r\n  });\r\n\r\n  // Notify renderer when DevTools open/close state changes\r\n  mainWindow.webContents.on('devtools-opened', () => {\r\n    mainWindow?.webContents.send('devtools-state-changed', true);\r\n  });\r\n  mainWindow.webContents.on('devtools-closed', () => {\r\n    mainWindow?.webContents.send('devtools-state-changed', false);\r\n  });\r\n\r\n  if (MAIN_WINDOW_VITE_DEV_SERVER_URL) {\r\n    await mainWindow.loadURL(MAIN_WINDOW_VITE_DEV_SERVER_URL);\r\n  } else {\r\n    await mainWindow.loadFile(join(__dirname, `../renderer/${MAIN_WINDOW_VITE_NAME}/index.html`));\r\n  }\r\n}\r\n\r\napp.whenReady().then(async () => {\r\n  // Configure Content Security Policy for additional security\r\n  session.defaultSession.setPermissionRequestHandler((webContents, permission, callback) => {\r\n    // Deny all permission requests for security\r\n    callback(false);\r\n  });\r\n\r\n  // Set additional CSP headers via session\r\n  session.defaultSession.webRequest.onHeadersReceived((details, callback) => {\r\n    callback({\r\n      responseHeaders: {\r\n        ...details.responseHeaders,\r\n        'Content-Security-Policy': [\r\n          \"default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; font-src 'self' data:; connect-src 'self' ws: wss:;\"\r\n        ]\r\n      }\r\n    });\r\n  });\r\n\r\n  await createMainWindow();\r\n\r\n  app.on('activate', () => {\r\n    if (BrowserWindow.getAllWindows().length === 0) {\r\n      void createMainWindow();\r\n    }\r\n  });\r\n});\r\n\r\napp.on('window-all-closed', () => {\r\n  if (process.platform !== 'darwin') app.quit();\r\n});\r\n\r\n// IPC handlers for window controls\r\nipcMain.handle('window:minimize', () => {\r\n  if (mainWindow) {\r\n    mainWindow.minimize();\r\n  }\r\n});\r\n\r\nipcMain.handle('window:toggle-maximize', () => {\r\n  if (mainWindow) {\r\n    if (mainWindow.isMaximized()) {\r\n      mainWindow.unmaximize();\r\n    } else {\r\n      mainWindow.maximize();\r\n    }\r\n  }\r\n});\r\n\r\nipcMain.handle('window:close', () => {\r\n  if (mainWindow) {\r\n    mainWindow.close();\r\n  }\r\n});\r\n\r\n// View / Dev tools / Zoom / Fullscreen helpers\r\nipcMain.handle('window:reload', () => {\r\n  if (mainWindow) {\r\n    mainWindow.reload();\r\n  }\r\n});\r\n\r\nipcMain.handle('window:toggle-devtools', () => {\r\n  if (mainWindow) {\r\n    if (mainWindow.webContents.isDevToolsOpened()) {\r\n      mainWindow.webContents.closeDevTools();\r\n    } else {\r\n      mainWindow.webContents.openDevTools({ mode: 'detach' });\r\n    }\r\n  }\r\n});\r\n\r\nipcMain.handle('window:is-devtools-open', () => {\r\n  if (mainWindow) {\r\n    return mainWindow.webContents.isDevToolsOpened();\r\n  }\r\n  return false;\r\n});\r\n\r\nipcMain.handle('window:force-reload', () => {\r\n  if (mainWindow) {\r\n    mainWindow.webContents.reloadIgnoringCache();\r\n  }\r\n});\r\n\r\nipcMain.handle('window:toggle-fullscreen', () => {\r\n  if (mainWindow) {\r\n    mainWindow.setFullScreen(!mainWindow.isFullScreen());\r\n  }\r\n});\r\n\r\nipcMain.handle('window:zoom-reset', () => {\r\n  if (mainWindow) {\r\n    mainWindow.webContents.setZoomFactor(1);\r\n    // Notify renderer of zoom change\r\n    mainWindow.webContents.send('zoom-changed', 1);\r\n  }\r\n});\r\n\r\nipcMain.handle('window:get-zoom-level', () => {\r\n  if (mainWindow) {\r\n    return mainWindow.webContents.getZoomFactor();\r\n  }\r\n  return 1;\r\n});\r\n\r\nipcMain.handle('window:zoom-in', () => {\r\n  if (mainWindow) {\r\n    const current = mainWindow.webContents.getZoomFactor();\r\n    const next = Math.min(3, Math.round((current + 0.1) * 10) / 10);\r\n    mainWindow.webContents.setZoomFactor(next);\r\n    // Notify renderer of zoom change\r\n    mainWindow.webContents.send('zoom-changed', next);\r\n  }\r\n});\r\n\r\nipcMain.handle('window:zoom-out', () => {\r\n  if (mainWindow) {\r\n    const current = mainWindow.webContents.getZoomFactor();\r\n    const next = Math.max(0.3, Math.round((current - 0.1) * 10) / 10);\r\n    mainWindow.webContents.setZoomFactor(next);\r\n    // Notify renderer of zoom change\r\n    mainWindow.webContents.send('zoom-changed', next);\r\n  }\r\n});\r\n\r\n// File open/save handlers\r\nipcMain.handle('file:open', async () => {\r\n  if (!mainWindow) return { canceled: true };\r\n  const result = await dialog.showOpenDialog(mainWindow, {\r\n    properties: ['openFile'],\r\n    filters: [\r\n      { name: 'Text Files', extensions: ['txt', 'md', 'log'] },\r\n      { name: 'All Files', extensions: ['*'] }\r\n    ]\r\n  });\r\n  if (result.canceled || result.filePaths.length === 0) {\r\n    return { canceled: true };\r\n  }\r\n  const path = result.filePaths[0];\r\n  const content = await readFile(path, 'utf8');\r\n  return { canceled: false, path, content };\r\n});\r\n\r\nipcMain.handle('file:save', async (_event, args: { path?: string; content: string }) => {\r\n  if (!mainWindow) return { canceled: true };\r\n  const { path: existingPath, content } = args ?? {};\r\n  let targetPath = existingPath;\r\n  if (!targetPath) {\r\n    const result = await dialog.showSaveDialog(mainWindow, {\r\n      filters: [\r\n        { name: 'Text Files', extensions: ['txt'] },\r\n        { name: 'All Files', extensions: ['*'] }\r\n      ]\r\n    });\r\n    if (result.canceled || !result.filePath) {\r\n      return { canceled: true };\r\n    }\r\n    targetPath = result.filePath;\r\n  }\r\n  await writeFile(targetPath, content, 'utf8');\r\n  return { canceled: false, path: targetPath };\r\n});\r\n\r\nipcMain.handle('file:save-as', async (_event, args: { content: string }) => {\r\n  if (!mainWindow) return { canceled: true };\r\n  const { content } = args ?? {};\r\n  const result = await dialog.showSaveDialog(mainWindow, {\r\n    filters: [\r\n      { name: 'Text Files', extensions: ['txt'] },\r\n      { name: 'All Files', extensions: ['*'] }\r\n    ]\r\n  });\r\n  if (result.canceled || !result.filePath) {\r\n    return { canceled: true };\r\n  }\r\n  await writeFile(result.filePath, content, 'utf8');\r\n  return { canceled: false, path: result.filePath };\r\n});\r\n\r\n\r\n"],"names":["__filename","fileURLToPath","__dirname","dirname","BrowserWindow","join","url","shell","app","session","ipcMain","dialog","path","readFile","writeFile"],"mappings":"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"}