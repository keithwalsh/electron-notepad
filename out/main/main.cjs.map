{"version":3,"file":"main.cjs","sources":["../../src/main.ts"],"sourcesContent":["import { app, BrowserWindow, shell, ipcMain, dialog, session } from 'electron';\r\nimport { readFile, writeFile } from 'fs/promises';\r\nimport { join, dirname } from 'path';\r\nimport { fileURLToPath } from 'url';\r\n\r\nconst __filename = fileURLToPath(import.meta.url);\r\nconst __dirname = dirname(__filename);\r\n\r\ndeclare const MAIN_WINDOW_VITE_DEV_SERVER_URL: string | undefined;\r\ndeclare const MAIN_WINDOW_VITE_NAME: string;\r\n\r\nlet mainWindow: BrowserWindow | null = null;\r\n\r\nasync function createMainWindow() {\r\n  mainWindow = new BrowserWindow({\r\n    width: 900,\r\n    height: 700,\r\n    frame: false, // Remove default frame for custom window controls\r\n    webPreferences: {\r\n      preload: join(__dirname, '../preload/index.js'),\r\n      contextIsolation: true,\r\n      nodeIntegration: false,\r\n      webSecurity: true // Enable web security\r\n    }\r\n  });\r\n\r\n  mainWindow.webContents.setWindowOpenHandler(({ url }) => {\r\n    shell.openExternal(url);\r\n    return { action: 'deny' };\r\n  });\r\n\r\n  // Notify renderer when DevTools open/close state changes\r\n  mainWindow.webContents.on('devtools-opened', () => {\r\n    mainWindow?.webContents.send('devtools-state-changed', true);\r\n  });\r\n  mainWindow.webContents.on('devtools-closed', () => {\r\n    mainWindow?.webContents.send('devtools-state-changed', false);\r\n  });\r\n\r\n  if (MAIN_WINDOW_VITE_DEV_SERVER_URL) {\r\n    await mainWindow.loadURL(MAIN_WINDOW_VITE_DEV_SERVER_URL);\r\n  } else {\r\n    await mainWindow.loadFile(join(__dirname, `../renderer/${MAIN_WINDOW_VITE_NAME}/index.html`));\r\n  }\r\n}\r\n\r\napp.whenReady().then(async () => {\r\n  // Configure Content Security Policy for additional security\r\n  session.defaultSession.setPermissionRequestHandler((webContents, permission, callback) => {\r\n    // Deny all permission requests for security\r\n    callback(false);\r\n  });\r\n\r\n  // Set additional CSP headers via session\r\n  session.defaultSession.webRequest.onHeadersReceived((details, callback) => {\r\n    callback({\r\n      responseHeaders: {\r\n        ...details.responseHeaders,\r\n        'Content-Security-Policy': [\r\n          \"default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; font-src 'self' data:; connect-src 'self' ws: wss:;\"\r\n        ]\r\n      }\r\n    });\r\n  });\r\n\r\n  await createMainWindow();\r\n\r\n  app.on('activate', () => {\r\n    if (BrowserWindow.getAllWindows().length === 0) {\r\n      void createMainWindow();\r\n    }\r\n  });\r\n});\r\n\r\napp.on('window-all-closed', () => {\r\n  if (process.platform !== 'darwin') app.quit();\r\n});\r\n\r\n// IPC handlers for window controls\r\nipcMain.handle('window:minimize', () => {\r\n  if (mainWindow) {\r\n    mainWindow.minimize();\r\n  }\r\n});\r\n\r\nipcMain.handle('window:toggle-maximize', () => {\r\n  if (mainWindow) {\r\n    if (mainWindow.isMaximized()) {\r\n      mainWindow.unmaximize();\r\n    } else {\r\n      mainWindow.maximize();\r\n    }\r\n  }\r\n});\r\n\r\nipcMain.handle('window:close', () => {\r\n  if (mainWindow) {\r\n    mainWindow.close();\r\n  }\r\n});\r\n\r\n// View / Dev tools / Zoom / Fullscreen helpers\r\nipcMain.handle('window:reload', () => {\r\n  if (mainWindow) {\r\n    mainWindow.reload();\r\n  }\r\n});\r\n\r\nipcMain.handle('window:toggle-devtools', () => {\r\n  if (mainWindow) {\r\n    if (mainWindow.webContents.isDevToolsOpened()) {\r\n      mainWindow.webContents.closeDevTools();\r\n    } else {\r\n      mainWindow.webContents.openDevTools({ mode: 'detach' });\r\n    }\r\n  }\r\n});\r\n\r\nipcMain.handle('window:is-devtools-open', () => {\r\n  if (mainWindow) {\r\n    return mainWindow.webContents.isDevToolsOpened();\r\n  }\r\n  return false;\r\n});\r\n\r\nipcMain.handle('window:force-reload', () => {\r\n  if (mainWindow) {\r\n    mainWindow.webContents.reloadIgnoringCache();\r\n  }\r\n});\r\n\r\nipcMain.handle('window:toggle-fullscreen', () => {\r\n  if (mainWindow) {\r\n    mainWindow.setFullScreen(!mainWindow.isFullScreen());\r\n  }\r\n});\r\n\r\nipcMain.handle('window:zoom-reset', () => {\r\n  if (mainWindow) {\r\n    mainWindow.webContents.setZoomFactor(1);\r\n    // Notify renderer of zoom change\r\n    mainWindow.webContents.send('zoom-changed', 1);\r\n  }\r\n});\r\n\r\nipcMain.handle('window:get-zoom-level', () => {\r\n  if (mainWindow) {\r\n    return mainWindow.webContents.getZoomFactor();\r\n  }\r\n  return 1;\r\n});\r\n\r\nipcMain.handle('window:zoom-in', () => {\r\n  if (mainWindow) {\r\n    const current = mainWindow.webContents.getZoomFactor();\r\n    const next = Math.min(3, Math.round((current + 0.1) * 10) / 10);\r\n    mainWindow.webContents.setZoomFactor(next);\r\n    // Notify renderer of zoom change\r\n    mainWindow.webContents.send('zoom-changed', next);\r\n  }\r\n});\r\n\r\nipcMain.handle('window:zoom-out', () => {\r\n  if (mainWindow) {\r\n    const current = mainWindow.webContents.getZoomFactor();\r\n    const next = Math.max(0.3, Math.round((current - 0.1) * 10) / 10);\r\n    mainWindow.webContents.setZoomFactor(next);\r\n    // Notify renderer of zoom change\r\n    mainWindow.webContents.send('zoom-changed', next);\r\n  }\r\n});\r\n\r\n// File open/save handlers\r\nipcMain.handle('file:open', async () => {\r\n  if (!mainWindow) return { canceled: true };\r\n  const result = await dialog.showOpenDialog(mainWindow, {\r\n    properties: ['openFile'],\r\n    filters: [\r\n      { name: 'Text Files', extensions: ['txt', 'md', 'log'] },\r\n      { name: 'All Files', extensions: ['*'] }\r\n    ]\r\n  });\r\n  if (result.canceled || result.filePaths.length === 0) {\r\n    return { canceled: true };\r\n  }\r\n  const path = result.filePaths[0];\r\n  const content = await readFile(path, 'utf8');\r\n  return { canceled: false, path, content };\r\n});\r\n\r\nipcMain.handle('file:save', async (_event, args: { path?: string; content: string }) => {\r\n  if (!mainWindow) return { canceled: true };\r\n  const { path: existingPath, content } = args ?? {};\r\n  let targetPath = existingPath;\r\n  if (!targetPath) {\r\n    const result = await dialog.showSaveDialog(mainWindow, {\r\n      filters: [\r\n        { name: 'Text Files', extensions: ['txt'] },\r\n        { name: 'All Files', extensions: ['*'] }\r\n      ]\r\n    });\r\n    if (result.canceled || !result.filePath) {\r\n      return { canceled: true };\r\n    }\r\n    targetPath = result.filePath;\r\n  }\r\n  await writeFile(targetPath, content, 'utf8');\r\n  return { canceled: false, path: targetPath };\r\n});\r\n\r\nipcMain.handle('file:save-as', async (_event, args: { content: string }) => {\r\n  if (!mainWindow) return { canceled: true };\r\n  const { content } = args ?? {};\r\n  const result = await dialog.showSaveDialog(mainWindow, {\r\n    filters: [\r\n      { name: 'Text Files', extensions: ['txt'] },\r\n      { name: 'All Files', extensions: ['*'] }\r\n    ]\r\n  });\r\n  if (result.canceled || !result.filePath) {\r\n    return { canceled: true };\r\n  }\r\n  await writeFile(result.filePath, content, 'utf8');\r\n  return { canceled: false, path: result.filePath };\r\n});\r\n\r\n\r\n"],"names":["__filename","fileURLToPath","__dirname","dirname","mainWindow","createMainWindow","BrowserWindow","join","url","shell","app","session","webContents","permission","callback","details","ipcMain","current","next","result","dialog","path","content","readFile","_event","args","existingPath","targetPath","writeFile"],"mappings":"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"}